// description: QBot process execution seen for week of 2023-06-12
SecurityEvent
  | where EventID == 4688
  | where (ProcessName == "conhost.exe" and CommandLine matches regex @"C:\\Users\\Public\\.*\.dll")
    or (ProcessName == "rundll32.exe" and CommandLine matches regex @"C:\\(Users\\.*\\|ProgramData\\).*\.(dat|dll)")
    or (ProcessName == "wscript.exe" and CommandLine matches regex @"C:\\Users\\Admin\\AppData\\Local\\Temp\\.*\.(wsf|js)")
| union 
(DeviceProcessEvents
  | where (FileName == "conhost.exe" and ProcessCommandLine matches regex @"C:\\Users\\Public\\.*\.dll")
    or (FileName == "rundll32.exe" and ProcessCommandLine matches regex @"C:\\(Users\\.*\\|ProgramData\\).*\.(dat|dll)")
    or (FileName == "wscript.exe" and ProcessCommandLine matches regex @"C:\\Users\\Admin\\AppData\\Local\\Temp\\.*\.(wsf|js)")
)