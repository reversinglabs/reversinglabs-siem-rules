// description: AsyncRAT network indicators for 20230925
let c2domains = external_data(c2domain: string) [h"https://raw.githubusercontent.com/reversinglabs/reversinglabs-siem-rules/master/Malware/AsyncRAT/20230925/KQL/asyncrat-20230925-c2domains.txt"];
let c2ips = external_data(c2ip: string) [h"https://raw.githubusercontent.com/reversinglabs/reversinglabs-siem-rules/master/Malware/AsyncRAT/20230925/KQL/asyncrat-20230925-c2ips.txt"];
CommonSecurityLog
| where DestinationHostName in (c2domains) or DestinationIP in (c2ips)
| union 
(DeviceNetworkEvents
| where RemoteIP in (c2ips)
),
(SysmonParser
| where (EventID == 3 and DestinationIp in (c2ips)) 
or (EventID == 22 and QueryName in (c2domains)))