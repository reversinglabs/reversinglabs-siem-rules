// description: PikaBot network indicators for 20231002
let c2ips = external_data(c2ip: string) [h"https://raw.githubusercontent.com/reversinglabs/reversinglabs-siem-rules/master/Malware/PikaBot/20231002/KQL/pikabot-20231002-c2ips.txt"];
CommonSecurityLog
| where DestinationIP in (c2ips)
| union 
(DeviceNetworkEvents
| where RemoteIP in (c2ips)
),
(SysmonParser
| where (EventID == 3 and DestinationIp in (c2ips),
(SysmonParser
| where EventID == 22
| where QueryName == "UL")) 