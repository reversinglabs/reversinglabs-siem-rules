# gozi-20230710

> *Want to stay in the loop? Subscribe to be notified for new Microsoft Sentinel content from ReversingLabs: https://www.reversinglabs.com/threat-intel-weekly-newsletter-sign-up*

## Notes for this week
Gozi/Ursnif has been seen using a few interesting domains for their C2 servers, such as `avas1t[.]de`.

# Query overview

- [gozi-20230710-files.kql](./gozi-20230710-files.kql) - This query checks CommonSecurityLog, DeviceFileEvents, and the SysmonParser function for matching files hashes and file names seen in Gozi malware.
- [gozi-20230710-network.kql](./gozi-20230710-network.kql) - This query checks the CommonSecurityLog table for matching domain name and URL indicators used by Gozi command and control servers.
- [NewProcess-DriversQueried.kql](./NewProcess-DriversQueried.kql) - This query identifies new processes where Windows drivers are queried. Gozi has been known to do this as part of recon activities.

> **Disclaimer**
> The queries listed above that use raw indicators are subject to change and may produce false positives due to the high frequency at which IcedID updates their processes. Specifically, the included file hashes have a low probability of detection due to the variations in each campaign. 

## Infection chain

```
1. Email
  |
  |-->2. Open .pdf file
    |
    |-->3. Download .zip file from URL
      |
      |-->4. Unpack and Execute .zip file
        |
        |-->4.1. Extract .js file
          |
          |-->5. Download .js file from URL
            |
            |-->5.1. Execute .js file
              |
              |-->6. Download .dll file from URL
                |
                |-->6.1. Unpack/Deobfuscate .dll file
                  |
                  |-->6.2. Execute .dll file
```

## MITRE ATT&CK
| Tactics           | Description                     | Technique |
|-------------------|---------------------------------|-----------|
| Initial Access    | Spear-phishing attachments      | T1193     |
|                   | Spear-phishing downloads        | T1204     |
| Execution         | Exploitation for Client         | T1203     |
|                   | Execution Through API           | T1059     |
| Persistence       | Scheduled Task/Job              | T1053     |
|                   | Modify Registry                 | T1112     |
| Defense Evasion   | Modify Registry                 | T1112     |
|                   | Obfuscated Files or Information | T1027     |
|                   | Process Injection               | T1055     |
| Credential Access | Input Capture                   | T1056     |
|                   | Screen Capture                  | T1114     |
| Command and Control | Commonly Used Port            | T1043     |
|                   | Application Layer Protocol

