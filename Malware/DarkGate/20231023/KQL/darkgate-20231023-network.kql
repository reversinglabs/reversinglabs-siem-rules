// description: DarkGate network indicators for 20231023
let c2ips = external_data(c2ip: string) [h"https://raw.githubusercontent.com/reversinglabs/reversinglabs-siem-rules/master/Malware/DarkGate/20231023/KQL/darkgate-20231023-c2.txt"];
let payloadUrls = external_data(payloadUrl: string) [h"https://raw.githubusercontent.com/reversinglabs/reversinglabs-siem-rules/master/Malware/DarkGate/20231023/KQL/darkgate-20231023-payloadurls.txt"];
CommonSecurityLog
| where DestinationIP in (c2ips) or RequestURL in (payloadUrls) or RequestClientApplication containts @"Mozilla/4.0 (compatible|3b 20|Synapse)"
| union 
(DeviceNetworkEvents
| where RemoteIP in (c2ips)
),
(SysmonParser
| where (EventID == 3 and DestinationIp in (c2ips)))